<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <link rel='shortcut icon' type='image/x-icon' href='favicon.ico'/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>
    <script src="js/main.js"></script>
    <title>CS 184 Final Project</title>
</head>

<meta name="viewport" content="width=device-width, initial-scale=1">

<body>

<h2 align="middle">CS 184: Computer Graphics and Imaging, Spring 2018</h2>
<h1 align="middle">Final Project: Cloth Rendering with OpenGL</h1>
<h3 align="middle">
    <small>
        <a href="#" data-placement="bottom" data-toggle="popover" data-content="CS184-acf; SID 26653732">
            Nader Namini Asl
        </a>,
        <a href="#" data-placement="top" data-toggle="popover" data-content="CS184-abq; SID 25145867">
            Tinh Nguyen
        </a>,
        <a href="#" data-placement="bottom" data-toggle="popover" data-content="CS184-agh; SID 26545047">
            Marc WuDunn
        </a>
    </small>
</h3>

<br><br>


<h2 align="middle">Overview</h2>
<p>
    In this project, we plan to extend project 4 (cloth simulation) by producing high quality cloth simulations using
    OpenGL shaders that take advantage of the parallelization power of GPUs. This will allow faster runtime of the
    simulation and provide the required accuracy to perform more complex operations on the cloth, such as
    self-collision. Moreover, using WebGL, we can provide a responsive environment to interact with the cloth simulation
    for users via the convenience of their web browsers.
</p>

<button class="accordion">Proposal</button>

<div class="panel">
    <button class="accordion">Problem Description</button>
    <div class="panel">
        In project 4, we observed how extensive cloth simulation can be without using any parallelization. In this
        project,
        we are hoping to harness GPU power by performing cloth simulation by using OpenGL shaders. Using GPUs allows us
        to parallelize the simulation more efficiently and obtain high quality and precise renderings at a much higher
        frame
        rate. The challenge lies in implementing cloth simulation algorithms such as Explicit Euler and Verlet
        Integration
        in OpenGL. Our teams' exposure to OpenGL has been limited to simple shading techniques such as Blinn-Phong and
        texture mapping. Therefore, our initial goal is to familiarize ourselves with OpenGL and its extension to C++ to
        be
        able to render different environment and basic shapes. Once we have mastered basic principles of OpenGL, we will
        start implementing different cloth simulation algorithm and from there add shapes and settings to our
        environment to
        render complex cloth simulations.
    </div>


    <button class="accordion">Goals and Deliverables</button>

    <div class="panel">
        <ul style="list-style-type:disc">
            <li>
                <em>What we plan to deliver:</em> We are planning to implement cloth rendering simulations in
                <code>OpenGL</code>. Our goal is to be able to make a <code>C++</code> application as in previous
                project with the functionality to interact with the environment, add components, and change
                settings. We will, first, start with simple environment renderings in <code>OpenGL</code> to
                experiment with using <code>OpenGL</code> along with <code>C++</code> in a more customized manner
                than done previously in project 3-2. In the next step, we will start with implementing simple to
                difficult cloth simulation algorithms such as Mass-spring model, Verlet Integration, and Explicit
                Euler Integration. Next step is to perform simulations first with the cloth itself, then add our
                dummy (traditionally a matte single-colored sphere) to the scene and simulate collisions; finally,
                we can add force and change environment settings such as wind to create more complex simulations.
                Our demo will be similar to the animations below although with different cloth simulation algorithm
                implementation and added interactive functions:
            </li>
            <div align="middle" class="table-responsive">
                <table class="table" style="width=100%">
                    <tr>
                        <td>
                            <figcaption align="middle">
                                <b>Source:</b> <a href="https://www.youtube.com/watch?v=NsjhUU8i4E8">Dayeol Lee, Taegyu
                                Kim
                                @POSTECH</a>
                            </figcaption>
                            <div id="cf15" class="container-fluid">
                                <img class='opaque' src="images/proposal/gifs/overview.gif" class="img-responsive"
                                     width="400px"/>
                                <img src="images/proposal/gifs/super-elastic_effects.gif" class="img-responsive"
                                     width="400px"/>
                                <img src="images/proposal/gifs/collision.gif" class="img-responsive" width="400px"/>
                                <img src="images/proposal/gifs/forces.gif" class="img-responsive" width="400px"/>
                            </div>
                            <p id="cf15_controls">
                                <span>Overview</span>
                                <span>Super-Elastic Effects</span>
                                <span class="selected">Collision</span>
                                <span>Forces</span>
                            </p>
                        </td>
                        <td>
                            <figcaption align="middle">
                                <b>Source</b> <a href="https://www.shadertoy.com/view/MldXWX">archee @ ShaderToy</a>
                            </figcaption>
                            <div id="cf16" class="container-fluid">
                                <img src="images/proposal/gifs/normal.gif" class='opaque' width="400px"/>
                            </div>

                        </td>
                    </tr>
                </table>
            </div>
            <br>


            <li>
                <em>What we hope to deliver:</em> Once we have been able to achieve all the goals outlined above, we
                hope to
                extend the project to <code>WebGL</code> and host the project online to achieve real-time cloth
                simulation
                renderings. In addition to this, we want to add additional capabilities to our simulator such as
                allowing
                users to modify elements in the environment such as lighting and component material including the cloth
                and
                the dummy.
            </li>
        </ul>
    </div>

    <button class="accordion">Schedule</button>

    <div class="panel">
        <ul style="list-style-type:disc">
            <li>
                Below you can view a rough timeline of the project. <em>Note</em> that the tasks are currently fairly
                general, but details will be added as progress is made on each part. Feel free to head over to <a
                    href="https://github.com/nadernamini/184-final-project/projects">the project board</a> over in <a
                    href="https://github.com/nadernamini/184-final-project">our GitHub repository</a> for the most
                up-to-date tasks.
            </li>
        </ul>
        <div class="container">
            <div class="page-header">
                <h1 id="timeline">Timeline</h1>
            </div>
            <ul class="timeline">
                <li>
                    <div class="timeline-badge"><i class="glyphicon glyphicon-search"></i></div>
                    <div class="timeline-panel">
                        <div class="timeline-heading">
                            <h4 class="timeline-title"><code>OpenGL</code>, Basic Environment Renderings</h4>
                            <p>
                                <small class="text-muted"><i class="glyphicon glyphicon-time"></i> 1.0 week
                                </small>
                            </p>
                        </div>
                        <div class="timeline-body">
                            <p>
                                Expand on the previous knowledge of <code>OpenGL</code>; Learn how to use
                                <code>OpenGL</code> in <code>C++</code> and create an interactive application; Prepare
                                basic
                                environment settings for future simulations.
                            </p>
                        </div>
                    </div>
                </li>
                <li class="timeline-inverted">
                    <div class="timeline-badge warning"><i class="glyphicon glyphicon-console"></i></div>
                    <div class="timeline-panel">
                        <div class="timeline-heading">
                            <h4 class="timeline-title">Basic Cloth Simulations</h4>
                            <p>
                                <small class="text-muted"><i class="glyphicon glyphicon-time"></i> 1.0 week
                                </small>
                            </p>
                        </div>
                        <div class="timeline-body">
                            <p>
                                Implement basic Cloth Simulation using <code>OpenGL</code> and <code>C++</code> using
                                Mass-spring model; Verlet Integration; Explicit Euler Integration.
                            </p>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="timeline-badge info"><i class="glyphicon glyphicon-record"></i></div>
                    <div class="timeline-panel">
                        <div class="timeline-heading">
                            <h4 class="timeline-title">Complex Cloth Simulations (Interactivity with <code>WebGL</code>)
                            </h4>
                            <p>
                                <small class="text-muted"><i class="glyphicon glyphicon-time"></i> 1.5 week
                                </small>
                            </p>
                        </div>
                        <div class="timeline-body">
                            <p>
                                Add extra components to the environment renderings such as dummy; force; elasticity;
                                texture; lighting; (Possibly) implement <code>WebGL</code>-based simulation
                            </p>
                        </div>
                    </div>
                </li>
                <li class="timeline-inverted">
                    <div class="timeline-badge success"><i class="glyphicon glyphicon-blackboard"></i></div>
                    <div class="timeline-panel">
                        <div class="timeline-heading">
                            <h4 class="timeline-title">Presentation and Demos</h4>
                            <p>
                                <small class="text-muted"><i class="glyphicon glyphicon-time"></i> 0.5 week
                                </small>
                            </p>
                        </div>
                        <div class="timeline-body">
                            <p>
                                Prepare the final presentation; finish high-quality and precise renders of cloth
                                simulations
                                with dummy, force, elasticity, texture, and lighting.
                            </p>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <button class="accordion">Resources</button>

    <div class="panel">
        <ul style="list-style-type:disc">
            <li>
                We are planning to use the <code>hive</code> or <code>s349</code> unix-based machines with the following
                specifications:
                <pre><code>
            Dell Optiplex 9020, Intel quad-core i7-4770 cpu (HT 3.4GHz turbo, 8MB, w/ HD graphics 4600)
            32GB RAM (4x8GB), 500GB SATA drive
            GeForce GT 740 1 GB DDR3 PCI Express 3.0 x16 Cuda GPU
            </code></pre>
                For software, we will be using <code>OpenGL 4.6</code> along with <code>WebGL 2.0</code> and
                <code>C++</code>.
            </li>
            <li>
                After researching online, we found a few papers and past projects that we can use as guides and
                references
                for this project. <em>Note</em> that we will be using project 4 as our starting code even though we will
                be
                implementing an extension to <code>OpenGL</code>. We will be adding to this list as the project
                progresses
                and making proper citations in our code, write-ups, and presentations:
                <a href="http://ieeexplore.ieee.org/document/6221705/">Hanwen Li and Yi Wan, An object-oriented system
                    for
                    dynamics-based 3D cloth simulation</a>,
                <a href="http://ieeexplore.ieee.org/document/7121014/">Minh Vo, Srinivasa G. Narasimhan, and Yaser
                    Sheikh,
                    Texture Illumination Separation for Single-Shot Structured Light Reconstruction</a>,
                <a href="http://www.stephenspinks.com/project.html">Stephen Spinks, Mass Spring Particle Systems</a>,
                <a href="https://github.com/dayeol/clothsimulation">Dayeol Lee and Taegyu Kim, OpenGL-simulated
                    Cloth</a>,
                and <a href="https://www.shadertoy.com/view/MldXWX">archee, curtain and ball</a>.
            </li>
        </ul>
    </div>
</div>

<button class="accordion">Milestone</button>

<div class="panel">
    <button class="accordion">Accomplishments and Results</button>

    <div class="panel">
        <ul style="list-style-type:disc">
            <li>
                In the first week, we focused on learning the basics of <code>OpenGL</code> and compute shaders using
                examples and tutorials. By the end of the second week, our team refactored code from previous projects
                to support<code>OpenGL</code>, allowing us to achieve higher quality and precise renderings. Using
                compute shaders, we parallelized mass-spring model updates, Verlet Integration, and external forces
                (wind / gravity). We successfully rendered a scene of a pinned cloth blown by the wind.
            </li>
            <div class="table-responsive" align="middle">
                <table class="table">
                    <tr>
                        <td>
                            <video loop controls class="embed-responsive-item">
                                <source src="assets/milestone/basic.mp4" type=video/mp4>
                            </video>
                            <figcaption align="middle">
                                Cloth Simulation with gravity as an external force
                            </figcaption>
                        </td>
                        <td>
                            <video loop controls class="embed-responsive-item">
                                <source src="assets/milestone/wind.mp4" type=video/mp4>
                            </video>
                            <figcaption align="middle">
                                Cloth Simulation with wind (into the screen) and gravity added as external forces
                            </figcaption>
                        </td>
                    </tr>
                </table>
            </div>
        </ul>
    </div>

    <button class="accordion">Progress and Updates</button>

    <div class="panel">
        <ul style="list-style-type:disc">
            <li>
                In the next coming weeks, we are aiming to produce more complex simulations by adding more environment
                settings for users to interact with. We hope to extend our basic scene with modifiable parameters for
                the cloth, external forces, and the viewing camera. Additionally, we have yet to develop shaders for
                self-collision and friction.
            </li>
            <li>
                Once we have been able to achieve the goals above, we want to potentially add a cloth tearing
                simulation as well as support for <code>WebGL</code>.
            </li>
        </ul>
    </div>

    <button class="accordion">Milestone Video</button>

    <div class="panel">
        <div class="videoWrapper">
            <iframe src="https://www.youtube.com/embed/Ir2MUfdk3Ks" frameborder="0"
                    allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
    </div>
</div>


<button class="accordion">Final Deliverables</button>

<div class="panel show">
    <button class="accordion">Summary</button>
    <div class="panel show">
        After completing project 4 (cloth simulation), we saw an opportunity to parallelize the simulation algorithms
        and systems in play. We aimed to extend that project by producing high quality cloth simulations using OpenGL
        shaders that take advantage of the parallelization power of GPUs. With the introduction of computeShaders in
        OpenGL 4.3, we are able to program and parallelize cloth simulation algorithm such as position updates,
        mass-spring systems, and collisions. With this added advantage, we were able to render high quality simulations
        at higher frame rates. On top of this, we implemented UI tools to allow our (Windows/Linux) users to interact
        with and manipulate the simulation.
    </div>

    <button class="accordion">Technical Summary</button>
    <div class="panel show">
        <ul style="list-style-type:disc">
            <li>
                In order to start parallelizing programs with OpenGL, we must first initialize buffers and allocate
                space for any simulation variables that may be used in parallel computation. In this project, we heavily
                used two data types for our bindings: <code>uniform</code>, <code>GL_*_BUFFER</code>. When working with
                constants and simple data types, we instantiate these data bindings with OpenGL’s uniform type in our
                shader program. For collection-like variables, like positions, normals and hash positions, we must first
                initialize our buffer and bind it using <code>glBindBufferBase</code>. Once we attach these buffers to
                our shader programs, we can dispatch parallel workgroups to run our programs.

            </li>

            <!-- CLOTH -->

            <li>
                First, we build our cloth mesh by generating a grid of point masses and their respective springs.
                Similar to project 4, we implemented the cloth using a grid of point masses which we converted to
                triangle strips and used OpenGL’s <code>glDrawElements</code> to render it.
            </li>

            <!-- Sphere -->

            <li>
                We generate the sphere using 2 angles, one going from \((-\pi/2 : \pi/2)\), and the other from
                \((0:2\pi)\). Then, using a certain spacing based on the number of points and the size of the sphere, we
                calculate a derivative, and then use this to calculate the positions of the points on the sphere. Each
                point corresponds to an intersection of a longitude and latitude line.
                Next, we construct a quad-mesh by using two triangles per quad, with each quad defined as the
                intersection of two longitude lines and two latitude lines. Then, each triangle is assigned a
                corresponding index based on its position in the mesh, and rendered using OpenGL’s
                <code>glDrawElements</code>.
            </li>

            <!-- Wind -->
            <li>
                To calculate wind on the cloth, at each timestep we update and pass in a time variable to the compute
                shader that handles the forces. Next, we calculate the force in the direction of the wind vector as a
                projection of the cloth’s velocity vector onto the wind vector, multiply it by the unit vector in the
                direction of the wind, and subtract this from the wind vector. Next, we add a lift force to the cloth,
                based on the normals of the cloth (calculated by taking neighboring points on the cloth and taking the
                normal). Finally, we multiply it by a strength/power function to obtain the force, and add it to the
                current force vector.
                The wind force is made to vary in time and space by taking the sin of the time added with the ID of the
                particle, and additional variance is added by multiplying it with a random value within a particular
                range (say, 0.7 to 1.3). This is done for each x, y, and z (with a slightly different multiplicative
                factor to each).

            </li>

            <!-- Position Update -->

            <li>
                Within the compute shader, we implemented Verlet Integration like in project 4. For each particle, we
                computed the forces on the particle from the various spring constraints (Structural, Bending, and
                Shearing). After updating the positions based on these corrective forces, we applied the 110% rule as
                described in the SIGGRAPH paper, in order to ensure that the simulation remained stable.
            </li>

            <!-- Object/Plane Collision -->
            <li>
                To do the plane collision, we checked if a particle crossed the plane from the last position to the
                current position. We rendered the plane using <code>glDrawElements</code> and four triangles.
            </li>

            <!-- Self-collision -->

            <li>
                Our implementation of self-collision uses spatial mapping. After applying all external forces to each of
                our point masses, we hash all the positions and build the spatial map every
                <code>simulation_steps</code> frames. With the spatial map computed, we iterate each point mass’s hash
                with our parallel work groups.

                Unfortunately, our results for self-collisions were not particularly good. Due to the nature of the
                implementation in project 4, we could not parallelizable it, and so a direct port of the implementation
                would not be fast enough.
                Instead, we developed our own algorithm. For each particle, we simply used the positions that we
                obtained after constraining the spring length and updated them separately, instead of using successive
                self-collision updates to adjust each particle in turn (since this serial implementation does not seem
                to have a natural parallelization).
                We also were not able to implement the hashmap from project 4 because of memory race conditions.
                Instead, we ported the hash function and used it to calculate index ‘i’ of a flattened 2D array (with
                format <code>array[i][j]</code>). Next, we calculated the particles within a particular box using a
                heuristic value, M, equal to a constant times the number of particles, divided by the number of boxes. M
                was used as the ‘size’ of the inner arrays (‘j’ index), and we took a random number from an RNG modulo
                this value to determine its position within this array. As a result, some values would naturally be
                overwritten when we stored it in the 2D array, however, we assumed that this would not noticeably affect
                the calculations of the self-collisions for a sufficiently large M (the expected number of collisions
                was not that high).
                Unfortunately, even with this implementation, we were not able to render satisfying results. When we
                tried using the original CPU implementation, without the successively updated positions, our results
                were also not particularly good. As a result, we decided to turn off the feature in favor of improving
                the FPS or our render.

            </li>

            <!-- GUI -->

            <li>
                In order to experiment and test our parallel implementations, we integrated Nanogui with OpenGL in order
                to simultaneously update scene variables to all distributed workgroups. Using sliding toggle bars, users
                can vary gravitational, wind and light direction in order to simulate different environments. Users can
                also update the position of the ball along all axes in real-time. Dragging or scrolling the mouse
                changes the camera’s viewing position and direction, allowing you to get a closer look at the details in
                the scene.
            </li>

        </ul>
    </div>

    <button class="accordion">Results</button>

    <div class="panel show">
        <div class="table-responsive" align="left">
            <table class="table">
                <tr>
                    <td>
                        <video loop controls class="embed-responsive-item">
                            <source src="assets/final/cloth-final.mp4" type=video/mp4>
                        </video>
                        <figcaption align="middle">
                            Cloth Simulation with gravity and wind
                        </figcaption>
                    </td>
                    <td>
                        <video loop controls class="embed-responsive-item">
                            <source src="assets/final/cloth-ball-final.mp4" type=video/mp4>
                        </video>
                        <figcaption align="middle">
                            Cloth Simulation with sphere
                        </figcaption>
                    </td>
                </tr>
                <br>
                <tr>
                    <td>
                        <video loop controls class="embed-responsive-item">
                            <source src="assets/final/cloth-plane.mp4" type=video/mp4>
                        </video>
                        <figcaption align="middle">
                            Cloth Simulation with plane (1)
                        </figcaption>
                    </td>
                    <td>
                        <video loop controls class="embed-responsive-item">
                            <source src="assets/final/cloth_plane.mp4" type=video/mp4>
                        </video>
                        <figcaption align="middle">
                            Cloth Simulation with plane (2)
                        </figcaption>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <button class="accordion">Contributions</button>

    <div class="panel show">
        <div class="table-responsive" align="middle">
            <table class="table">
                <tr>
                    <td align="left">
                        <p><b>Nader Namini Asl</b></p>
                        <ul style="list-style-type:disc">
                            <li>Fully implemented cloth constraint compute shader</li>
                            <li>Upgraded Explicit Euler Integration to Verlet Integration</li>
                            <li>Parallelized spring-mass system in cloth compute shader</li>
                            <li>Implemented self-collisions (GPU and CPU version)</li>
                            <li>Created and rendered the plane and implemented plane-collision</li>
                            <li>Worked on CMake files and repo/package management</li>
                            <li>Worked on camera position updates and movements</li>
                            <li>Worked on Nanogui features and their integration with shaders</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td align="left">
                        <p><b>Tinh Nguyen</b></p>
                        <ul style="list-style-type:disc">
                            <li>Integrated Nanogui with OpenGL compute Shaders</li>
                            <li>Worked on camera position updates and movements</li>
                            <li>Worked on self-collisions</li>
                            <li>Implemented user interactions (keyevents, mouseEvents)</li>
                            <li>Ported code from Project 4</li>
                            <li>Set up OpenGL on Windows/Linux</li>
                            <li>Worked on texture mapping</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td align="left">
                        <p><b>Marc WuDunn</b></p>
                        <ul style="list-style-type:disc">
                            <li>Implemented the initial window and render loop.</li>
                            <li>Implemented the cloth, rendered it, and calculated the original position updates using
                                Explicit Euler Integration (in a compute shader). Some parts were overwritten when we
                                did Verlet Integration.
                            </li>
                            <li>Developed two approaches for the wind force to the cloth and implemented them.</li>
                            <li>Created and rendered the sphere (using a vertex shader rather than a compute shader).
                            </li>
                            <li>Implemented collisions for the sphere.</li>
                            <li>Implemented phong shading for the cloth and the sphere.</li>
                            <li>Developed our algorithm for self-collisions</li>
                        </ul>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <button class="accordion">References</button>
    <div class="panel show">
        <ul style="list-style-type:disc">
            <!-- Learn OpenGL -->

            <li>
                <a href="https://learnopengl.com/">LearnOpenGL (tutorial)</a>
            </li>

            <!-- OpenGL Cookbook -->

            <li>
                <a href="https://www.amazon.com/OpenGL-Shading-Language-Cookbook-Second/dp/1782167021/">David Wolff -
                    OpenGL 4.0 Shading Language Cookbook - Second Edition (tutorial)</a>, <a
                    href="https://github.com/daw42/glslcookbook">GitHub Repo</a>
            </li>

            <!-- Pseudo-RNG function -->

            <li>
                <a href="https://stackoverflow.com/questions/4200224/random-noise-functions-for-glsl/4275343#4275343">Appas
                    on StackOverflow - One line Pseudo-RNG function</a>
            </li>

            <!-- Project 4 -->
            <li>
                <a href="https://cs184.eecs.berkeley.edu/article/35">CS184 Spring 2018 - Project 4</a>
            </li>

            <!-- SIGGRAPH Paper -->

            <li>
                <a href="https://www.cs.rpi.edu/~cutler/classes/advancedgraphics/S14/papers/provot_cloth_simulation_96.pdf">SIGGRAPH
                    1995 Provot paper</a>
            </li>

        </ul>
    </div>

    <button class="accordion">Final Video</button>
    <div class="panel show">
        <div class="videoWrapper">
            <iframe src="https://www.youtube.com/embed/t1yyAvkT6DA" frameborder="0"
                    allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
    </div>


    <script>
        $(document).ready(function () {
            $('[data-toggle="popover"]').popover();
        });
    </script>
</body>
</html>
